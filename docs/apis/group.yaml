openapi: 3.0.3
info:
  title: Group Management API
  version: "1.0"
  description: This API is used to manage groups.
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html

servers:
  - url: https://{host}:{port}
    variables:
      host:
        default: "localhost"
      port:
        default: "8090"

tags:
  - name: groups
    description: Operations related to group management

paths:
  /groups:
    get:
      tags:
        - groups
      summary: List root groups
      parameters:
        - $ref: '#/components/parameters/limitQueryParam'
        - $ref: '#/components/parameters/offsetQueryParam'
      responses:
        "200":
          description: List of root groups
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GroupListResponse'
              example:
                totalResults: 2
                startIndex: 1
                count: 2
                groups:
                  - id: "3fa85f64-5717-4562-b3fc-2c963f66afa6"
                    handle: "sports"
                    name: "Sports"
                    description: "Sports group"
                    parent:
                      type: "organizationUnit"
                      id: "a839f4bd-39dc-4eaa-b5cc-210d8ecaee87"
                  - id: "257e528f-eb24-48b6-884d-20460e190957"
                    handle: "managers"
                    name: "Managers"
                    description: "Manager group"
                    parent:
                      type: "organizationUnit"
                      id: "a839f4bd-39dc-4eaa-b5cc-210d8ecaee87"
                links:
                  - href: "groups?offset=2&limit=2"
                    rel: "next"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid-request-format:
                  summary: Invalid request format
                  value:
                    code: "GRP-1001"
                    message: "Invalid request format"
                    description: "The request body is malformed or contains invalid data"
                invalid-limit:
                  summary: Invalid limit parameter
                  value:
                    code: "GRP-1001"
                    message: "Invalid request format"
                    description: "Invalid limit parameter value"
                invalid-offset:
                  summary: Invalid offset parameter
                  value:
                    code: "GRP-1001"
                    message: "Invalid request format"
                    description: "Invalid offset parameter value"
        "500":
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string
              example: "Internal server error"

    post:
      tags:
        - groups
      summary: Create a new group
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGroupRequest'
            examples:
              root-group:
                summary: Root group
                value:
                  handle: "sports"
                  name: "Sports"
                  description: "Sports group"
                  parent:
                    type: "organizationUnit"
                    id: "a839f4bd-39dc-4eaa-b5cc-210d8ecaee87"
                  users:
                    - "7a4b1f8e-5c69-4b60-9232-2b0aaf65ef3c"
                    - "9f1e47d3-0347-4464-9f02-e0bfae02e896"
              nested-group:
                summary: Nested group
                value:
                  handle: "hockey"
                  name: "Hockey"
                  description: "Hockey group"
                  parent:
                    type: "group"
                    id: "3fa85f64-5717-4562-b3fc-2c963f66afa6"
                  users:
                    - "2cbb94c7-81f1-44e3-8e9e-75e0c3dd36da"
      responses:
        "201":
          description: Group created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Group'
              examples:
                root-group:
                  summary: Root group
                  value:
                    id: "3fa85f64-5717-4562-b3fc-2c963f66afa6"
                    handle: "sports"
                    name: "Sports"
                    description: "Sports group"
                    parent:
                      type: "organizationUnit"
                      id: "a839f4bd-39dc-4eaa-b5cc-210d8ecaee87"
                nested-group:
                  summary: Nested group
                  value:
                    id: "6b1e7b8d-7e19-41eb-8fa2-c0ee5bb67a94"
                    handle: "hockey"
                    name: "Hockey"
                    description: "Hockey group"
                    parent:
                      type: "group"
                      id: "3fa85f64-5717-4562-b3fc-2c963f66afa6"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid-request-format:
                  summary: Invalid request format
                  value:
                    code: "GRP-1001"
                    message: "Invalid request format"
                    description: "The request body is malformed or contains invalid data"
                invalid-user-id:
                  summary: Invalid user ID
                  value:
                    code: "GRP-1007"
                    message: "Invalid user ID"
                    description: "One or more user IDs in the request do not exist"
                parent-not-found:
                  summary: Parent not found
                  value:
                    code: "GRP-1005"
                    message: "Parent not found"
                    description: "Parent group or organization unit not found"
        "409":
          description: Conflict
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: "GRP-1004"
                message: "Group name conflict"
                description: "A group with the same name exists under the same parent"
        "500":
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string
              example: "Internal server error"

  /groups/{id}:
    get:
      tags:
        - groups
      summary: Get a group by id
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Group details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Group'
              example:
                id: "3fa85f64-5717-4562-b3fc-2c963f66afa6"
                handle: "sports"
                name: "Sports"
                description: "Sports group"
                parent:
                  type: "organizationUnit"
                  id: "a839f4bd-39dc-4eaa-b5cc-210d8ecaee87"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: "GRP-1002"
                message: "Invalid request format"
                description: "Group ID is required"
        "404":
          description: Group not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: "GRP-1003"
                message: "Group not found"
                description: "The group with the specified id does not exist"
        "500":
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string
              example: "Internal server error"

    put:
      tags:
        - groups
      summary: Update a group by id
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateGroupRequest'
            example:
              handle: "activities"
              name: "Activities"
              description: "Activities group"
              parent:
                type: "organizationUnit"
                id: "a839f4bd-39dc-4eaa-b5cc-210d8ecaee87"
              users:
                - "7a4b1f8e-5c69-4b60-9232-2b0aaf65ef3c"
                - "9f1e47d3-0347-4464-9f02-e0bfae02e896"
                - "2cbb94c7-81f1-44e3-8e9e-75e0c3dd36da"
      responses:
        "200":
          description: Group updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Group'
              example:
                id: "3fa85f64-5717-4562-b3fc-2c963f66afa6"
                handle: "activities"
                name: "Activities"
                description: "Activities group"
                parent:
                  type: "organizationUnit"
                  id: "a839f4bd-39dc-4eaa-b5cc-210d8ecaee87"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missing-group-id:
                  summary: Missing group ID
                  value:
                    code: "GRP-1002"
                    message: "Invalid request format"
                    description: "Group ID is required"
                invalid-request-format:
                  summary: Invalid request format
                  value:
                    code: "GRP-1001"
                    message: "Invalid request format"
                    description: "The request body is malformed or contains invalid data"
                invalid-user-id:
                  summary: Invalid user ID
                  value:
                    code: "GRP-1007"
                    message: "Invalid user ID"
                    description: "One or more user IDs in the request do not exist"
                parent-not-found:
                  summary: Parent not found
                  value:
                    code: "GRP-1005"
                    message: "Parent not found"
                    description: "Parent group or organization unit not found"
        "404":
          description: Group not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: "GRP-1003"
                message: "Group not found"
                description: "The group with the specified id does not exist"
        "409":
          description: Conflict
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: "GRP-1004"
                message: "Group name conflict"
                description: "A group with the same name exists under the same parent"
        "500":
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string
              example: "Internal server error"

    delete:
      tags:
        - groups
      summary: Delete a group by id
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "204":
          description: Group deleted
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missing-group-id:
                  summary: Missing group ID
                  value:
                    code: "GRP-1002"
                    message: "Invalid request format"
                    description: "Group ID is required"
                cannot-delete-group:
                  summary: Cannot delete group
                  value:
                    code: "GRP-1006"
                    message: "Cannot delete group"
                    description: "Cannot delete group with child groups"
        "404":
          description: Group not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: "GRP-1003"
                message: "Group not found"
                description: "The group with the specified id does not exist"
        "500":
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string
              example: "Internal server error"

  /groups/{id}/children:
    get:
      tags:
        - groups
      summary: List child groups
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
        - $ref: '#/components/parameters/limitQueryParam'
        - $ref: '#/components/parameters/offsetQueryParam'
      responses:
        "200":
          description: List of child groups
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GroupListResponse'
              example:
                totalResults: 2
                startIndex: 1
                count: 2
                groups:
                  - id: "6b1e7b8d-7e19-41eb-8fa2-c0ee5bb67a94"
                    handle: "hockey"
                    name: "Hockey"
                    description: "Hockey group"
                    parent:
                      type: "group"
                      id: "3fa85f64-5717-4562-b3fc-2c963f66afa6"
                  - id: "8c2f8e9e-8f2a-4f5b-9c3d-4e5f6a7b8c9d"
                    handle: "football"
                    name: "Football"
                    description: "Football group"
                    parent:
                      type: "group"
                      id: "3fa85f64-5717-4562-b3fc-2c963f66afa6"
                links:
                  - href: "groups/3fa85f64-5717-4562-b3fc-2c963f66afa6/children?offset=2&limit=2"
                    rel: "next"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid-limit:
                  summary: Invalid limit parameter
                  value:
                    code: "GRP-1001"
                    message: "Invalid request format"
                    description: "Invalid limit parameter value"
                invalid-offset:
                  summary: Invalid offset parameter
                  value:
                    code: "GRP-1001"
                    message: "Invalid request format"
                    description: "Invalid offset parameter value"
        "404":
          description: Group not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: "GRP-1003"
                message: "Group not found"
                description: "The group with the specified id does not exist"
        "500":
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string
              example: "Internal server error"

  /groups/{id}/users:
    get:
      tags:
        - groups
      summary: List users in group
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
        - $ref: '#/components/parameters/limitQueryParam'
        - $ref: '#/components/parameters/offsetQueryParam'
      responses:
        "200":
          description: List of users in the group
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserListResponse'
              example:
                totalResults: 2
                startIndex: 1
                count: 2
                users:
                  - id: "7a4b1f8e-5c69-4b60-9232-2b0aaf65ef3c"
                  - id: "9f1e47d3-0347-4464-9f02-e0bfae02e896"
                links:
                  - href: "groups/3fa85f64-5717-4562-b3fc-2c963f66afa6/users?offset=2&limit=2"
                    rel: "next"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid-limit:
                  summary: Invalid limit parameter
                  value:
                    code: "GRP-1001"
                    message: "Invalid request format"
                    description: "Invalid limit parameter value"
                invalid-offset:
                  summary: Invalid offset parameter
                  value:
                    code: "GRP-1001"
                    message: "Invalid request format"
                    description: "Invalid offset parameter value"
        "404":
          description: Group not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: "GRP-1003"
                message: "Group not found"
                description: "The group with the specified id does not exist"
        "500":
          description: Internal server error
          content:
            text/plain:
              schema:
                type: string
              example: "Internal server error"

components:
  parameters:
    limitQueryParam:
      in: query
      name: limit
      required: false
      description: |
        Maximum number of records to return.
      schema:
        type: integer
        minimum: 1
        default: 30
    offsetQueryParam:
      in: query
      name: offset
      required: false
      description: |
        Number of records to skip for pagination.
      schema:
        type: integer
        default: 0

  schemas:
    Parent:
      type: object
      properties:
        type:
          type: string
          enum:
            - group
            - organizationUnit
        id:
          type: string
          format: uuid

    Group:
      type: object
      required: [id, handle, name, parent]
      properties:
        id:
          type: string
          format: uuid
        handle:
          type: string
          description: "The unique handle for the group within its parent"
        name:
          type: string
        description:
          type: string
          nullable: true
        parent:
          $ref: '#/components/schemas/Parent'

    CreateGroupRequest:
      type: object
      required: [handle, name, parent]
      properties:
        handle:
          type: string
          description: "The unique handle for the group within its parent"
        name:
          type: string
        description:
          type: string
        parent:
          $ref: '#/components/schemas/Parent'
        users:
          type: array
          items:
            type: string
            format: uuid

    UpdateGroupRequest:
      allOf:
        - $ref: '#/components/schemas/CreateGroupRequest'

    GroupListResponse:
      type: object
      properties:
        totalResults:
          type: integer
          description: "Number of results that match the listing operation."
          example: 8
        startIndex:
          type: integer
          description: "Index of the first element of the page, which will be equal to offset + 1."
          example: 1
        count:
          type: integer
          description: "Number of elements in the returned page."
          example: 5
        groups:
          type: array
          items:
            $ref: '#/components/schemas/Group'
        links:
          type: array
          items:
            $ref: '#/components/schemas/Link'

    User:
      type: object
      required: [id]
      properties:
        id:
          type: string
          format: uuid

    UserListResponse:
      type: object
      properties:
        totalResults:
          type: integer
          description: "Number of results that match the listing operation."
          example: 25
        startIndex:
          type: integer
          description: "Index of the first element of the page, which will be equal to offset + 1."
          example: 1
        count:
          type: integer
          description: "Number of elements in the returned page."
          example: 10
        users:
          type: array
          items:
            $ref: '#/components/schemas/User'
        links:
          type: array
          items:
            $ref: '#/components/schemas/Link'

    Link:
      type: object
      properties:
        href:
          type: string
          example: "groups?offset=20&limit=10"
        rel:
          type: string
          example: "next"

    Error:
      type: object
      required: [code, message]
      properties:
        code:
          type: string
          description: Error code
          example: "GRP-1001"
        message:
          type: string
          description: Error message
          example: "Invalid request format"
        description:
          type: string
          description: Detailed error description
          example: "The request body is malformed or contains invalid data"
