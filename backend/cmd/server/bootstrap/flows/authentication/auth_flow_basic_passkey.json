{
  "name": "Basic + Passkey Authentication and Registration Flow",
  "handle": "default-basic-passkey-flow",
  "flowType": "AUTHENTICATION",
  "nodes": [
    {
      "id": "start",
      "type": "START",
      "onSuccess": "choose_auth_method"
    },
    {
      "id": "choose_auth_method",
      "type": "PROMPT",
      "meta": {
        "components": [
          {
            "type": "TEXT",
            "id": "text_001",
            "label": "Sign In",
            "variant": "HEADING_1"
          },
          {
            "type": "BLOCK",
            "id": "block_basic",
            "components": [
              {
                "id": "input_username",
                "ref": "username",
                "type": "TEXT_INPUT",
                "label": "Username",
                "required": true,
                "placeholder": "Enter your username"
              },
              {
                "id": "input_password",
                "ref": "password",
                "type": "PASSWORD_INPUT",
                "label": "Password",
                "required": true,
                "placeholder": "Enter your password"
              },
              {
                "type": "ACTION",
                "id": "action_basic",
                "label": "Sign In",
                "variant": "PRIMARY",
                "eventType": "SUBMIT"
              }
            ]
          },
          {
            "type": "DIVIDER",
            "id": "divider_001"
          },
          {
            "type": "BLOCK",
            "id": "block_passkey",
            "components": [
              {
                "type": "ACTION",
                "id": "action_passkey",
                "label": "Sign in with Passkey",
                "variant": "SECONDARY",
                "eventType": "SUBMIT"
              }
            ]
          }
        ]
      },
      "prompts": [
        {
          "inputs": [
            {
              "ref": "input_username",
              "identifier": "username",
              "type": "TEXT_INPUT",
              "required": true
            },
            {
              "ref": "input_password",
              "identifier": "password",
              "type": "PASSWORD_INPUT",
              "required": true
            }
          ],
          "action": {
            "ref": "action_basic",
            "nextNode": "basic_auth"
          }
        },
        {
          "action": {
            "ref": "action_passkey",
            "nextNode": "prompt_passkey_identifier"
          }
        }
      ]
    },
    {
      "id": "prompt_passkey_identifier",
      "type": "PROMPT",
      "meta": {
        "components": [
          {
            "type": "TEXT",
            "id": "text_002",
            "label": "Sign in with Passkey",
            "variant": "HEADING_1"
          },
          {
            "type": "BLOCK",
            "id": "block_identifier",
            "components": [
              {
                "id": "passkey_username",
                "ref": "username",
                "type": "TEXT_INPUT",
                "label": "Username",
                "required": true,
                "placeholder": "Enter your username"
              },
              {
                "type": "ACTION",
                "id": "action_continue",
                "label": "Continue",
                "variant": "PRIMARY",
                "eventType": "SUBMIT"
              }
            ]
          }
        ]
      },
      "prompts": [
        {
          "inputs": [
            {
              "ref": "passkey_username",
              "identifier": "username",
              "type": "TEXT_INPUT",
              "required": true
            }
          ],
          "action": {
            "ref": "action_continue",
            "nextNode": "identity_resolver"
          }
        }
      ]
    },
    {
      "id": "identity_resolver",
      "type": "TASK_EXECUTION",
      "executor": {
        "name": "IdentifyingExecutor"
      },
      "onSuccess": "passkey_challenge"
    },
    {
      "id": "passkey_challenge",
      "type": "TASK_EXECUTION",
      "properties": {
        "relyingPartyId": "localhost",
        "relyingPartyName": "Thunder"
      },
      "executor": {
        "name": "PasskeyAuthExecutor",
        "mode": "challenge"
      },
      "onSuccess": "passkey_verify",
      "onFailure": "prompt_password_for_registration"
    },
    {
      "id": "passkey_verify",
      "type": "TASK_EXECUTION",
      "executor": {
        "name": "PasskeyAuthExecutor",
        "mode": "verify"
      },
      "onSuccess": "auth_assert"
    },
    {
      "id": "prompt_password_for_registration",
      "type": "PROMPT",
      "meta": {
        "components": [
          {
            "type": "TEXT",
            "id": "text_004",
            "label": "Register Passkey",
            "variant": "HEADING_1"
          },
          {
            "type": "TEXT",
            "id": "text_005",
            "label": "No passkey found for your account. Enter your password to register a new passkey.",
            "variant": "BODY"
          },
          {
            "type": "BLOCK",
            "id": "block_password_reg",
            "components": [
              {
                "id": "reg_password",
                "ref": "password",
                "type": "PASSWORD_INPUT",
                "label": "Password",
                "required": true,
                "placeholder": "Enter your password"
              },
              {
                "type": "ACTION",
                "id": "action_verify_password",
                "label": "Register Passkey",
                "variant": "PRIMARY",
                "eventType": "SUBMIT"
              }
            ]
          }
        ]
      },
      "prompts": [
        {
          "inputs": [
            {
              "ref": "reg_password",
              "identifier": "password",
              "type": "PASSWORD_INPUT",
              "required": true
            }
          ],
          "action": {
            "ref": "action_verify_password",
            "nextNode": "basic_auth_for_registration"
          }
        }
      ]
    },
    {
      "id": "basic_auth_for_registration",
      "type": "TASK_EXECUTION",
      "executor": {
        "name": "BasicAuthExecutor"
      },
      "onSuccess": "passkey_register_start"
    },
    {
      "id": "passkey_register_start",
      "type": "TASK_EXECUTION",
      "properties": {
        "relyingPartyId": "localhost",
        "relyingPartyName": "Thunder"
      },
      "executor": {
        "name": "PasskeyAuthExecutor",
        "mode": "register_start"
      },
      "onSuccess": "passkey_register_finish"
    },
    {
      "id": "passkey_register_finish",
      "type": "TASK_EXECUTION",
      "executor": {
        "name": "PasskeyAuthExecutor",
        "mode": "register_finish"
      },
      "onSuccess": "auth_assert"
    },
    {
      "id": "basic_auth",
      "type": "TASK_EXECUTION",
      "executor": {
        "name": "BasicAuthExecutor"
      },
      "onSuccess": "auth_assert"
    },
    {
      "id": "auth_assert",
      "type": "TASK_EXECUTION",
      "executor": {
        "name": "AuthAssertExecutor"
      },
      "onSuccess": "end"
    },
    {
      "id": "end",
      "type": "END"
    }
  ]
}
